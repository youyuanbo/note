# 文件上传与下载

## 文件上传

### apache上传组件方案

1. 添加依赖

   ```xml
   <!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload -->
   <dependency>
       <groupId>commons-fileupload</groupId>
       <artifactId>commons-fileupload</artifactId>
       <version>1.4</version>
   </dependency>
   
   ```

2. 在springMVC中注册

   ```xml
       <!--文件上传解析器-->
       <!--此处的id必须是commonsMultipartResolver-->
       <bean id="commonsMultipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
           <!--定义最大上传大小，单位是bytes-->
           <property name="maxUploadSize" value="1024000"/>
           <!--指定上传的编码-->
           <property name="defaultEncoding" value="UTF-8"/>
           <!--定义单个文件上传大小-->
           <property name="maxUploadSizePerFile" value="102400"/>
       </bean>
   ```

3. 编写FileController类

   ```java
   package com.spring.controller;
   
   import org.springframework.stereotype.Controller;
   import org.springframework.ui.Model;
   import org.springframework.web.bind.annotation.RequestMapping;
   import org.springframework.web.bind.annotation.RequestParam;
   import org.springframework.web.multipart.MultipartFile;
   
   import java.io.File;
   import java.io.IOException;
   import java.util.Date;
   
   @Controller
   @RequestMapping("/file")
   public class FileController {
       // 上传文件路径
       private static String uploadPath = "F:" + File.separator;
       // 代表上传的文件
       @RequestMapping("/upload")
       public String upload(@RequestParam("file")MultipartFile multipartFile, Model model){
           //1. 上传路径
           //2. 文件类型
           //3. 上传逻辑
           
           //1. 判断上传的文件是否为空
           if (multipartFile != null && !multipartFile.isEmpty()){
               //2. 获取源文件名称
               String originalFilename = multipartFile.getOriginalFilename();
               //3. 截取源文件名称前缀
               String fileNamePrefix = originalFilename.substring(0,originalFilename.lastIndexOf("."));
               //4. 加工文件名称，在源文件名称上添加时间戳
               String newFileNamePrefix = fileNamePrefix + new Date().getTime();
               //5. 得到新的文件名
               String newFileName = newFileNamePrefix + originalFilename.substring(originalFilename.lastIndexOf("."));
               //6. 构建文件对象
               File file = new File(uploadPath + newFileName);
               //7. 上传
               try {
                   multipartFile.transferTo(file);
                   model.addAttribute("fileName", newFileName);
               } catch (IOException e) {
                   e.printStackTrace();
               }
               System.out.println(originalFilename);
           }
           return "uploadSuccess";
       }
   }
   
   ```

4. 上传的页面，编写upload.jsp文件

   ```jsp
   <%--
     Created by IntelliJ IDEA.
     User: centos
     Date: 2019/1/26
     Time: 20:49
     To change this template use File | Settings | File Templates.
   --%>
   <%@ page contentType="text/html;charset=UTF-8" language="java" %>
   <html>
   <head>
       <title>Title</title>
   </head>
   <body>
       <%--添加一个 enctype="multipart/form-data"--%>
       <form action="${context}/file/upload" method="post" enctype="multipart/form-data">
           文件：<input type="file" name="file"><br>
           <input type="submit" value="提交">
       </form>
   </body>
   </html>
   
   ```

### Spring容器



## 文件下载

